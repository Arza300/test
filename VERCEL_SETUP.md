# تشغيل المنصة على Vercel (الدورات + التسجيل + إنشاء حساب)

إذا الموقع يعمل محلياً لكن على Vercel لا تظهر الدورات ولا يعمل التسجيل أو إنشاء الحساب، السبب أن **متغيرات البيئة** غير مضبوطة على Vercel أو أن **قاعدة البيانات** المستخدمة على السيرفر غير صحيحة.

## خطوات الحل (بالترتيب)

### 1) إنشاء قاعدة بيانات سحابية (إن لم تكن لديك)

- ادخل إلى **[Neon](https://neon.tech)** أو **[Supabase](https://supabase.com)** وأنشئ مشروعاً مجانياً.
- من لوحة المشروع انسخ **رابط الاتصال (Connection string)** لقاعدة PostgreSQL.  
  يبدو تقريباً هكذا:  
  `postgresql://user:password@ep-xxx.region.aws.neon.tech/neondb?sslmode=require`  
  **مهم:** استخدم الرابط السحابي (من Neon أو Supabase)، وليس أي رابط من جهازك (localhost).

### 2) تطبيق الجداول على هذه القاعدة (مرة واحدة من جهازك)

على جهازك في مجلد المشروع:

1. أنشئ أو عدّل ملف `.env` وضَع فيه **نفس** رابط القاعدة السحابية:
   ```env
   DATABASE_URL="postgresql://....?sslmode=require"
   ```
2. نفّذ:
   ```bash
   npm run db:push
   ```
3. (اختياري) لملء بيانات تجريبية (مستخدمين، دورات):
   ```bash
   npm run db:seed
   ```

بعدها لن تحتاج لتشغيل هذه الأوامر على السيرفر؛ Vercel سيستخدم نفس القاعدة عبر المتغيرات.

### 3) إضافة المتغيرات في Vercel

1. ادخل إلى مشروعك على **Vercel** → **Settings** → **Environment Variables**.
2. أضف المتغيرات التالية (اختر بيئة **Production**، ويمكن أيضاً **Preview**):

| اسم المتغير      | القيمة |
|------------------|--------|
| `DATABASE_URL`   | **نفس** رابط PostgreSQL من Neon أو Supabase (الذي استخدمته في `.env` و `db:push`). |
| `NEXTAUTH_SECRET`| أي نص عشوائي طويل (مثلاً 32 حرفاً). يمكن استخدام: https://generate-secret.vercel.app/32 |
| `NEXTAUTH_URL`   | عنوان موقعك على Vercel بالضبط، مثل: `https://your-app.vercel.app` أو `https://your-domain.com` (بدون شرطة في النهاية). |

3. احفظ كل متغير (Save).

**تحذير:**  
- لا تستخدم `DATABASE_URL` من جهازك المحلي (localhost) على Vercel.  
- `NEXTAUTH_URL` يجب أن يطابق عنوان الموقع بعد النشر (مع `https://`).

### 4) إعادة النشر (Redeploy)

بعد حفظ المتغيرات:

- من **Deployments** اختر آخر نشر → **⋯** → **Redeploy** (بدون استخدام الـ cache إن أمكن).

انتظر حتى ينتهي النشر.

### 5) التحقق من أن كل شيء يعمل

افتح في المتصفح:

```
https://your-app.vercel.app/api/health
```

- إذا ظهر `"ok": true` و `"database": { "status": "ok" }` و `"auth": { "ready": true }` فالإعداد صحيح.
- إذا ظهر خطأ، ستجد رسالة توضح ما الناقص (مثلاً: `DATABASE_URL` غير معيّن، أو لا يمكن الوصول لقاعدة البيانات). أضف أو صحّح المتغيرات ثم أعد النشر وجرب `/api/health` مرة أخرى.

بعد أن يصبح `/api/health` يعيد `ok: true`:

- يجب أن تظهر **الدورات** في الصفحة الرئيسية وصفحة الكورسات.
- يجب أن يعمل **إنشاء الحساب** و**تسجيل الدخول** بشكل طبيعي.

---

## ملخص سريع

1. قاعدة سحابية (Neon/Supabase) ← انسخ رابط الاتصال.  
2. محلياً: ضع الرابط في `.env` ثم `npm run db:push` (واختيارياً `npm run db:seed`).  
3. في Vercel: أضف `DATABASE_URL` و `NEXTAUTH_SECRET` و `NEXTAUTH_URL` ثم Redeploy.  
4. تحقق من `/api/health` ثم جرّب الموقع.

إذا نفذت هذه الخطوات وما زال شيء لا يعمل، انسخ نتيجة `/api/health` (أو رسالة الخطأ التي تظهر عند التسجيل) لمعرفة السبب بدقة.
